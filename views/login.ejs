<!DOCTYPE html>

<html lang="es">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Inicio De Sesi√≥n</title>

  <!-- Vincula el archivo CSS para estilos -->

  <link rel="stylesheet" href="/Style.css" />



</head>

<body>


  <div class="container" id="container">

    <!-- Panel de Registro a la izquierda -->

    <div class="form-container sign-up-container">

      <form id="registerForm">

    <img src=Logo.jpg alt="LOGOTIPO"  width="200" height="180" loading="lazy">

        <h2>Registrarse</h2>

        <input type="text" placeholder="Nombre" name="nombre" required />

        <input type="email" placeholder="Email" name="email" required />


          <input 
            type="password" 
            placeholder="Contrase√±a" 
            name="password" 
            id="registerPassword" 
            required
            pattern="^(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{6,}$"
            title="La contrase√±a debe tener m√≠nimo 6 caracteres, una may√∫scula, un n√∫mero y un s√≠mbolo"
          />

        <button type="submit">REGISTRARSE</button>

    

      </form>

    </div>


    <!-- Panel de Inicio de Sesi√≥n a la derecha -->

    <div class="form-container sign-in-container">

      <form id="loginForm">

    <img src=Logo.jpg alt="LOGOTIPO"  width="200" height="180" loading="lazy">

        <h2>Iniciar Sesi√≥n</h2>

        

        <input type="email" placeholder="Email" name="email" required />

        <input type="password" placeholder="Contrase√±a" name="password" required />
        

        <a href="/recuperar-contrasena">¬øOlvidaste tu contrase√±a?</a>

        <button type="submit">INICIAR SESI√ìN</button>

      </form>

    </div>


    <!-- Panel con los mensajes y botones para alternar -->

    <div class="overlay-container">

      <div class="overlay">

        <!-- Panel cuando est√°s en modo de bienvenida para registro -->

        <div class="overlay-panel overlay-left">

          <h1>¬°Hola!</h1>

          <p>¬°√önete a INNOVA SIGET! Reg√≠strate y comienza a gestionar tus bit√°coras de laboratorio y recibir soporte t√©cnico de manera r√°pida.</p>

          <button class="ghost" id="signIn">Iniciar sesi√≥n</button>

        </div>

        <!-- Panel cuando est√°s en modo bienvenida para login -->

        <div class="overlay-panel overlay-right">

          <h1>¬°Bienvenido!</h1>

          <p>INNOVA SIGET te da la bienvenida. Bit√°coras digitales y soporte t√©cnico universitario al alcance de tu mano.</p>

          <button class="ghost" id="signUp">Registrarse</button>

        </div>

      </div>

    </div>

  </div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const container = document.getElementById('container');
  const loginForm = document.getElementById('loginForm');
  const registerForm = document.getElementById('registerForm');

  const signUpButton = document.getElementById('signUp');
  const signInButton = document.getElementById('signIn');

  if (!container || !loginForm || !registerForm || !signUpButton || !signInButton) {
    console.error('‚ùå Elementos del DOM no encontrados');
    return;
  }

  /* =========================
     BOTONES DE CAMBIO DE PANEL
  ========================= */
  signUpButton.addEventListener('click', () => {
    container.classList.add('right-panel-active');
  });

  signInButton.addEventListener('click', () => {
    container.classList.remove('right-panel-active');
  });

  /* =========================
     LOGIN
  ========================= */
  loginForm.addEventListener('submit', async e => {
    e.preventDefault();

    const email = e.target.email.value;
    const password = e.target.password.value;

    try {
      const res = await fetch('/auth/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email, password })
      });

      const text = await res.text();
      let data;

      try {
        data = JSON.parse(text);
      } catch {
        alert(text);
        return;
      }

      if (!res.ok) {
        alert(data.message);
        return;
      }

      if (data.rol === 'ALUMNO') location.href = '/alumno';
      if (data.rol === 'DOCENTE') location.href = '/docente';
      if (data.rol === 'PERSONAL') location.href = '/personal';
      if (data.rol === 'TECNICO') location.href = '/mantenimiento';

    } catch (err) {
      console.error(err);
      alert('Error de conexi√≥n con el servidor');
    }
  });

  /* =========================
     REGISTRO
  ========================= */
  registerForm.addEventListener('submit', async e => {
    e.preventDefault();

    const nombre = e.target.nombre.value;
    const email = e.target.email.value;
    const password = e.target.password.value;

    console.log('üì§ Enviando registro...', { nombre, email, password });

    try {
      const res = await fetch('/auth/register', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ nombre, email, password })
      });

      const text = await res.text();
      console.log('üì• RESPUESTA RAW:', text);

      let data;
      try {
        data = JSON.parse(text);
      } catch {
        alert(text);
        return;
      }

      if (!res.ok) {
        alert(data.message);
        return;
      }

      alert('Registro exitoso, ahora inicia sesi√≥n');
      container.classList.remove('right-panel-active');

    } catch (err) {
      console.error('‚ùå FETCH ERROR:', err);
      alert('Error de conexi√≥n con el servidor');
    }
  });

});
</script>
